<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Карта</title>
    <link rel="stylesheet" type="text/css" href="/css/headerStyle.css">
    <link rel="stylesheet" type="text/css" href="/css/mapStyle.css">
</head>
<body>
<div th:insert="client/header :: header"></div>
<div id="map"></div>
<script>
    function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: -33.866, lng: 151.196 },
            zoom: 15,
        });
        const infowindow = new google.maps.InfoWindow();

        const serviceUrl = "http://localhost:8080/maps";

        fetch(serviceUrl)
            .then(response => response.json())
            .then(markers => {
                markers.forEach(marker => {
                    const { id, address, latitude, longitude } = marker;

                    const markerPosition = { lat: latitude, lng: longitude };

                    const newMarker = new google.maps.Marker({
                        map,
                        position: markerPosition
                    });

                    google.maps.event.addListener(newMarker, "click", () => {
                        const content = document.createElement("div");
                        const nameElement = document.createElement("h2");

                        nameElement.textContent = id;
                        content.appendChild(nameElement);

                        const placeIdElement = document.createElement("p");

                        placeIdElement.textContent = id;
                        content.appendChild(placeIdElement);

                        const placeAddressElement = document.createElement("p");

                        placeAddressElement.textContent = address;
                        content.appendChild(placeAddressElement);

                        infowindow.setContent(content);
                        infowindow.open(map, newMarker);
                    });
                });
            })
            .catch(error => console.error("Error fetching markers:", error));
    }

    window.initMap = initMap;
</script>

<script
        src="https://maps.googleapis.com/maps/api/js?key=GOOGLE_API_KEY&callback=initMap"
        async defer
></script>

</body>
</html>